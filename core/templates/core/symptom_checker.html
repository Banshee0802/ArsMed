{% extends 'core/base.html' %}
{% load static %}


{% block extra_js %}
    <script src="{% static 'js/symptom_checker.js' %}"></script>
{% endblock %}
    

{% block content %}
<div class="symptom-checker">
    <div class="checker-header">
        <h2>üè• –ò–ò-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Ars Medica</h2>
    </div>
    
    <form method="post" id="symptomForm">
        {% csrf_token %}
        <div class="form-group">
            <label>–û–ø–∏—à–∏—Ç–µ –∂–∞–ª–æ–±—ã (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤):</label>
            <textarea name="symptoms" rows="4" id="userInput">{{ symptoms }}</textarea>
        </div>
        <button type="submit" class="submit-btn" id="submitBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>
        <p style="font-size: 0.8rem; color: #6c757d; margin-top: 10px; line-height: 1.2;">
            –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é GigaChat –≤ —Ü–µ–ª—è—Ö –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. 
            –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–æ—Å–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è.
        </p>

    </form>

    {% if error %}
        <div style="color: #d32f2f; margin-top: 15px;">{{ error }}</div>
    {% endif %}

    {% if response %}
        <div class="ai-card" id="aiCard">
            <h4 style="color: #007bff;">–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞:</h4>
            <!-- –ü–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–∞ -->
            <div id="typewriter" class="typing-text"></div>
            <p class="disclaimer">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –≠—Ç–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º –æ—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä –≤—Ä–∞—á–∞.</p>
        </div>

        <script>
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏ —Ç–µ–∫—Å—Ç–∞
            const text = `{{ response|escapejs }}`;
            const target = document.getElementById('typewriter');
            let i = 0;

            function typeWriter() {
                if (i < text.length) {
                    target.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typeWriter, 15); // –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—á–∞—Ç–∏
                }
            }
            // –ó–∞–ø—É—Å–∫ –ø–µ—á–∞—Ç–∏
            typeWriter();
        </script>
    {% endif %}
</div>

<script>
    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–µ
    document.getElementById('symptomForm').onsubmit = function() {
        const btn = document.getElementById('submitBtn');
        btn.innerHTML = "‚åõ –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...";
        btn.style.opacity = "0.7";
        btn.disabled = true;
    };
</script>
{% endblock %}

