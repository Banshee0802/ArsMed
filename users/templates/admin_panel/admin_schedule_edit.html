{% extends "core/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile/schedule.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/admin_schedule_toggle.js' %}" data-search-url="{% url 'users:search_patients' %}"></script>
{% endblock %}

{% block content %}

<div class="admin-card">

    <h1 class="admin-title">Редактировать запись</h1>

    <form method="post" enctype="multipart/form-data" class="admin-form">
        {% csrf_token %}

    <div class="form-group">
        {{ form.doctor.label_tag }}
        {{ form.doctor }}
    </div>

    <div class="form-group">
        {{ form.date.label_tag }}
        {{ form.date }}
    </div>

    <div class="form-group">
        {{ form.start_time.label_tag }}
        {{ form.start_time }}
    </div>

    <div class="form-group">
        {{ form.end_time.label_tag }}
        {{ form.end_time }}
    </div>

    <div class="form-group">
        {{ form.status.label_tag }}
        {{ form.status }}
    </div>

   <div class="form-group">
        <label>Пациент:</label>
        <div class="search-patient">
            <input type="text" id="patient-query" placeholder="ФИО или телефон">
            <button type="button" id="search-btn">Найти</button>
        </div>
        <div id="patient-results" class="patient-results"></div>
        <input type="hidden" name="booked_by" id="selected-patient-id" value="{% if object.booked_by %}{{ object.booked_by.id }}{% endif %}">
        <div id="selected-patient" class="selected-patient">
            {% if object.booked_by %}
                <strong>{{ object.booked_by.last_name|upper }} {{ object.booked_by.first_name|upper }} {{ object.booked_by.patronymic|upper|default:"" }}</strong><br>
                Телефон: {{ object.booked_by.phone }}<br>
                Дата рождения: {{ object.booked_by.birth_date|date:"d.m.Y" }}
            {% else %}
                <em>Пациент не назначен</em>
            {% endif %}
        </div>
    </div>

    <div class="form-group">
        {{ form.medical_report.label_tag }}
        {{ form.medical_report }}
        {% if form.instance.medical_report %}
            <small>Текущий файл: <a href="{{ form.instance.medical_report.url }}" target="_blank">Скачать</a></small>
        {% endif %}
    </div>

        <p>Загрузка заключения автоматически завершит приём</p>

        <button type="submit" class="submit-btn">Сохранить</button>
    </form>

    

    <a href="{% url 'users:admin_schedule_list' %}" class="back-btn">Назад</a>

</div>

{% endblock %}
